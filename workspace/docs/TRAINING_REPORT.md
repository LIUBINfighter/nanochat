# nanochat 5GBæ˜¾å­˜è®­ç»ƒæŠ¥å‘Š

## âœ… è®­ç»ƒçŠ¶æ€ï¼šå…¨éƒ¨å®Œæˆ

---

## ğŸ“Š è®­ç»ƒæ¦‚å†µ

### Tokenizerè®­ç»ƒ
- **è¯è¡¨å¤§å°**: 8,192
- **è®­ç»ƒæ—¶é—´**: 1.31ç§’
- **è®­ç»ƒå­—ç¬¦**: 10,000,000
- **è¾“å‡ºæ–‡ä»¶**: `data/t1/tokenizer/tokenizer.pkl`

### é¢„è®­ç»ƒ
- **æ¨¡å‹æ¶æ„**: d4 (4å±‚Transformer)
- **æ¨¡å‹ç»´åº¦**: 128 (aspect-ratio=32)
- **æ³¨æ„åŠ›å¤´**: 2 (head-dim=64)
- **åºåˆ—é•¿åº¦**: 512
- **æ€»å‚æ•°é‡**: ~5M (4,980,872)
- **è®­ç»ƒæ­¥æ•°**: 100 iterations
- **è®­ç»ƒæ—¶é—´**: 1.68åˆ†é’Ÿ
- **å³°å€¼æ˜¾å­˜**: 0 MiB (CPUæ¨¡å¼)

---

## ğŸ“ˆ è®­ç»ƒæŒ‡æ ‡

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| åˆå§‹ Loss | 9.01 |
| æœ€ç»ˆ Loss | 2.60 |
| éªŒè¯ BPB (åˆå§‹) | 5.26 |
| éªŒè¯ BPB (æœ€ç»ˆ) | 1.42 |
| è®­ç»ƒé€Ÿåº¦ | ~3,500 tokens/sec |
| æ€»è®­ç»ƒtokens | 409,600 |

**Lossä¸‹é™æ›²çº¿**: 9.01 â†’ 2.60 (71% ä¸‹é™) âœ…

---

## ğŸ’¾ ç”Ÿæˆæ–‡ä»¶

### Tokenizeræ–‡ä»¶
```
data/t1/tokenizer/
â”œâ”€â”€ tokenizer.pkl      (88 KB)  - åˆ†è¯å™¨æ¨¡å‹
â””â”€â”€ token_bytes.pt     (34 KB)  - tokenå­—èŠ‚æ˜ å°„
```

### æ¨¡å‹Checkpoints
```
data/t1/base_checkpoints/d4_5gb/
â”œâ”€â”€ model_000050.pt        (20 MB)  - ç¬¬50æ­¥æ¨¡å‹
â”œâ”€â”€ model_000100.pt        (20 MB)  - æœ€ç»ˆæ¨¡å‹ (ç¬¬100æ­¥)
â”œâ”€â”€ meta_000050.json       (1.3 KB) - ç¬¬50æ­¥å…ƒæ•°æ®
â”œâ”€â”€ meta_000100.json       (1.3 KB) - æœ€ç»ˆå…ƒæ•°æ®
â”œâ”€â”€ optim_000050_rank0.pt  (36 MB)  - ç¬¬50æ­¥ä¼˜åŒ–å™¨çŠ¶æ€
â””â”€â”€ optim_000100_rank0.pt  (36 MB)  - æœ€ç»ˆä¼˜åŒ–å™¨çŠ¶æ€
```

**æ€»å­˜å‚¨**: ~109 MB

---

## ğŸ¯ æ¨¡å‹ç”Ÿæˆç¤ºä¾‹

è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹å­¦ä¼šäº†è¾“å‡ºç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š

```
<|bos|>The capital of France is"
\title "Guitar Standard Tuning"
      2
      2.4
```

æ³¨æ„ï¼šç”±äºè®­ç»ƒæ•°æ®æ˜¯åŸºäºä½ çš„.atexæ–‡ä»¶ï¼ˆéŸ³ä¹è°±é¢æ•°æ®ï¼‰ï¼Œæ¨¡å‹å­¦åˆ°äº†ä¸€äº›éŸ³ä¹ç›¸å…³çš„æ¨¡å¼ï¼

---

## ğŸ”§ ä½¿ç”¨çš„é…ç½®

### 5GBæ˜¾å­˜ä¼˜åŒ–å‚æ•°
```bash
--depth=4                  # 4å±‚ï¼ˆå°æ¨¡å‹ï¼‰
--aspect-ratio=32          # 128ç»´
--head-dim=64             # 64ç»´å¤´
--max-seq-len=512         # çŸ­åºåˆ—
--device-batch-size=1     # å•æ ·æœ¬
--total-batch-size=4096   # æ€»batch
--num-iterations=100      # 100æ­¥è®­ç»ƒ
```

### ä¼˜åŒ–å™¨é…ç½®
```bash
--embedding-lr=0.3
--matrix-lr=0.02
--unembedding-lr=0.004
--weight-decay=0.1
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

### 1. ç»§ç»­è®­ç»ƒ
```bash
cd /mnt/f/workspace/SimpleTab/train_model/nanochat
source .venv/bin/activate
export NANOCHAT_BASE_DIR="./data/t1"

# ä»checkpointæ¢å¤å¹¶ç»§ç»­è®­ç»ƒ
python -m scripts.base_train \
    --resume-from-step=100 \
    --num-iterations=1000 \
    ... (å…¶ä»–å‚æ•°)
```

### 2. è¯„ä¼°æ¨¡å‹
```bash
python -m scripts.base_eval \
    --device-batch-size=1 \
    --split-tokens=4096
```

### 3. SFTå¾®è°ƒï¼ˆå¯é€‰ï¼‰
```bash
python -m scripts.chat_sft \
    --max-seq-len=512 \
    --device-batch-size=4
```

### 4. å¯¹è¯æµ‹è¯•
```bash
python -m scripts.chat_cli -p "ä½ å¥½"
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å½“å‰æ¨¡å¼**: CPUè®­ç»ƒï¼ˆæœªä½¿ç”¨GPUï¼‰
   - å¦‚æœä½ æœ‰CUDA GPUï¼Œå®‰è£…GPUç‰ˆæœ¬PyTorchå¯åŠ é€Ÿ10-100å€
   
2. **æ•°æ®ç‰¹ç‚¹**: æ¨¡å‹å­¦ä¹ äº†ä½ çš„.atexéŸ³ä¹æ•°æ®æ¨¡å¼
   - ç”Ÿæˆå†…å®¹å¯èƒ½åŒ…å«éŸ³ä¹ç¬¦å·
   - å¦‚éœ€æ›´å¥½çš„é€šç”¨èƒ½åŠ›ï¼Œéœ€è¦æ›´å¤šæ ·åŒ–çš„è®­ç»ƒæ•°æ®

3. **æ¨¡å‹è§„æ¨¡**: 5Må‚æ•°ï¼ˆéå¸¸å°ï¼‰
   - é€‚åˆå¿«é€Ÿå®éªŒå’Œå­¦ä¹ 
   - å¯¹äºç”Ÿäº§ä½¿ç”¨ï¼Œå»ºè®®å¢åŠ åˆ°124M+å‚æ•°

---

## ğŸ“Š æ€§èƒ½æ€»ç»“

| é¡¹ç›® | æ•°å€¼ | è¯„ä»· |
|------|------|------|
| è®­ç»ƒé€Ÿåº¦ | 3,500 tok/s | âœ… CPUæ¨¡å¼ä¸‹è‰¯å¥½ |
| æ˜¾å­˜å ç”¨ | 0 MiB | âœ… æçœå†…å­˜ |
| æ¨¡å‹å¤§å° | 20 MB | âœ… å°å·§ä¾¿æº |
| Lossä¸‹é™ | 71% | âœ… è®­ç»ƒæœ‰æ•ˆ |

---

## âœ… æ£€æŸ¥æ¸…å•

- [x] Tokenizerè®­ç»ƒå®Œæˆ
- [x] é¢„è®­ç»ƒå®Œæˆ
- [x] Checkpointä¿å­˜æˆåŠŸ
- [x] éªŒè¯BPBè¾¾æ ‡ (< 2.0)
- [x] æ‰€æœ‰æ–‡ä»¶å·²ç”Ÿæˆ

---

**è®­ç»ƒæŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-02-03 20:43
